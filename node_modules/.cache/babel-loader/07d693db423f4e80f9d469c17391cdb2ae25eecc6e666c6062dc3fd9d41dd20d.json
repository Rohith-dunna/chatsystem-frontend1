{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import axios from'axios';import AuthForm from'./components/AuthForm';import Chat from'./components/Chat';import{jsx as _jsx}from\"react/jsx-runtime\";function App(){const[token,setToken]=useState(localStorage.getItem('token')||null);const[username,setUsername]=useState('');const[currentRoom,setCurrentRoom]=useState(null);const[messages,setMessages]=useState([]);const wsRef=useRef(null);// WebSocket Connection\nuseEffect(()=>{if(token&&!wsRef.current){wsRef.current=new WebSocket(\"\".concat(process.env.REACT_APP_WS_URL,\"?token=\").concat(token)||\"ws://localhost:8080?token=\".concat(token));wsRef.current.onopen=()=>console.log('WebSocket connected');wsRef.current.onmessage=event=>{const data=JSON.parse(event.data);if(data.type==='history'){setMessages(data.messages);}else if(data.type==='message'){setMessages(prev=>[...prev,data]);}};wsRef.current.onclose=()=>{console.log('WebSocket disconnected');wsRef.current=null;};}return()=>{if(wsRef.current){wsRef.current.close();wsRef.current=null;}};},[token]);// Handle Login\nconst handleLogin=async credentials=>{try{const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/login\")||'http://localhost:8080/api/login',credentials);setToken(res.data.token);setUsername(credentials.username);localStorage.setItem('token',res.data.token);}catch(error){var _error$response,_error$response$data;alert(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Server error');}};// Handle Register\nconst handleRegister=async credentials=>{try{const res=await axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/api/register\")||'http://localhost:8080/api/register',credentials);alert('Registration successful! Please login.');}catch(error){var _error$response2,_error$response2$data;alert(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.error)||'Server error');}};// Handle Logout\nconst handleLogout=()=>{setToken(null);setUsername('');setCurrentRoom(null);setMessages([]);localStorage.removeItem('token');};// Join Room\nconst joinRoom=roomId=>{if(wsRef.current&&wsRef.current.readyState===WebSocket.OPEN){wsRef.current.send(JSON.stringify({type:'join',roomId}));setCurrentRoom(roomId);setMessages([]);}};return token?/*#__PURE__*/_jsx(Chat,{username:username,currentRoom:currentRoom,messages:messages,joinRoom:joinRoom,sendMessage:text=>{var _wsRef$current;return(_wsRef$current=wsRef.current)===null||_wsRef$current===void 0?void 0:_wsRef$current.send(JSON.stringify({type:'message',text}));},logout:handleLogout}):/*#__PURE__*/_jsx(AuthForm,{onLogin:handleLogin,onRegister:handleRegister});}export default App;","map":{"version":3,"names":["React","useState","useEffect","useRef","axios","AuthForm","Chat","jsx","_jsx","App","token","setToken","localStorage","getItem","username","setUsername","currentRoom","setCurrentRoom","messages","setMessages","wsRef","current","WebSocket","concat","process","env","REACT_APP_WS_URL","onopen","console","log","onmessage","event","data","JSON","parse","type","prev","onclose","close","handleLogin","credentials","res","post","REACT_APP_API_URL","setItem","error","_error$response","_error$response$data","alert","response","handleRegister","_error$response2","_error$response2$data","handleLogout","removeItem","joinRoom","roomId","readyState","OPEN","send","stringify","sendMessage","text","_wsRef$current","logout","onLogin","onRegister"],"sources":["D:/chatsystem/frontend/src/App.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport axios from 'axios';\nimport AuthForm from './components/AuthForm';\nimport Chat from './components/Chat';\n\nfunction App() {\n  const [token, setToken] = useState(localStorage.getItem('token') || null);\n  const [username, setUsername] = useState('');\n  const [currentRoom, setCurrentRoom] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const wsRef = useRef(null);\n\n  // WebSocket Connection\n  useEffect(() => {\n    if (token && !wsRef.current) {\n      wsRef.current = new WebSocket(`${process.env.REACT_APP_WS_URL}?token=${token}` || `ws://localhost:8080?token=${token}`);\n\n      wsRef.current.onopen = () => console.log('WebSocket connected');\n\n      wsRef.current.onmessage = (event) => {\n        const data = JSON.parse(event.data);\n        if (data.type === 'history') {\n          setMessages(data.messages);\n        } else if (data.type === 'message') {\n          setMessages(prev => [...prev, data]);\n        }\n      };\n\n      wsRef.current.onclose = () => {\n        console.log('WebSocket disconnected');\n        wsRef.current = null;\n      };\n    }\n\n    return () => {\n      if (wsRef.current) {\n        wsRef.current.close();\n        wsRef.current = null;\n      }\n    };\n  }, [token]);\n\n  // Handle Login\n  const handleLogin = async (credentials) => {\n    try {\n      const res = await axios.post(`${process.env.REACT_APP_API_URL}/api/login` || 'http://localhost:8080/api/login', credentials);\n      setToken(res.data.token);\n      setUsername(credentials.username);\n      localStorage.setItem('token', res.data.token);\n    } catch (error) {\n      alert(error.response?.data?.error || 'Server error');\n    }\n  };\n\n  // Handle Register\n  const handleRegister = async (credentials) => {\n    try {\n      const res = await axios.post(`${process.env.REACT_APP_API_URL}/api/register` || 'http://localhost:8080/api/register', credentials);\n      alert('Registration successful! Please login.');\n    } catch (error) {\n      alert(error.response?.data?.error || 'Server error');\n    }\n  };\n\n  // Handle Logout\n  const handleLogout = () => {\n    setToken(null);\n    setUsername('');\n    setCurrentRoom(null);\n    setMessages([]);\n    localStorage.removeItem('token');\n  };\n\n  // Join Room\n  const joinRoom = (roomId) => {\n    if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify({ type: 'join', roomId }));\n      setCurrentRoom(roomId);\n      setMessages([]);\n    }\n  };\n\n  return token ? (\n    <Chat\n      username={username}\n      currentRoom={currentRoom}\n      messages={messages}\n      joinRoom={joinRoom}\n      sendMessage={(text) => wsRef.current?.send(JSON.stringify({ type: 'message', text }))}\n      logout={handleLogout}\n    />\n  ) : (\n    <AuthForm onLogin={handleLogin} onRegister={handleRegister} />\n  );\n}\n\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}